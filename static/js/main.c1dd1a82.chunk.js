(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{22:function(e,t,a){e.exports=a(58)},28:function(e,t,a){},55:function(e,t,a){},58:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),l=a(15),s=a.n(l),r=(a(28),a(16)),i=a(17),d=a(20),c=a(18),u=a(3),h=a(21),p=a(19),y=a(10),m=a.n(y),f=(a(55),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(d.a)(this,Object(c.a)(t).call(this,e))).sdk=null,n.state={started:!1,received:"",receivedData:new Uint8Array([]),disabled:!0,decryptDisabled:!0,downloadDisabled:!0,message:"",payload:new Uint8Array([]),sendButtonTxt:"SEND 1/1",nextPart:!1,autoSend:!0},n.payloadChunks=[],n.payloadCount=0,n.payloadCountMax=1,n.maxFileSize=1e6,n.decryptedResult=new Uint8Array([]),n.handleFileSelect=n.handleFileSelect.bind(Object(u.a)(n)),n.handleMessageChange=n.handleMessageChange.bind(Object(u.a)(n)),n.downloadByteArray=n.downloadByteArray.bind(Object(u.a)(n)),n.tick=n.tick.bind(Object(u.a)(n)),n.handleAutoCheck=n.handleAutoCheck.bind(Object(u.a)(n)),n.concatTypedArray=a(56),n.audioError="Failed to open web audio stream.\n    This may happen if your browser doesn't support Web Audio or have a mic and speaker.",n}return Object(h.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this;"WebAssembly"in window?this.timerID=setInterval(function(){return e.tick()},100):window.alert("WebAssembly is not supported in this browser")}},{key:"componentWillUnmount",value:function(){clearInterval(this.timerID)}},{key:"tick",value:function(){var e=this;this.state.nextPart&&this.setState({nextPart:!1},function(){0!==e.payloadCount&&e.payloadCount<e.payloadChunks.length&&e.state.autoSend&&e.sdk.send(e.payloadChunks[e.payloadCount])})}},{key:"chunkArray",value:function(e,t){var a=0,n=e.length,o=[];for(a=0;a<n;a+=t){var l=e.slice(a,a+t);o.push(l)}return o}},{key:"collapse",value:function(){var e=document.getElementsByClassName("collapse-content")[0];e.style.maxHeight?e.style.maxHeight=null:e.style.maxHeight=e.scrollHeight+"px"}},{key:"checkIfHex",value:function(e){for(var t=/^[0-9a-fA-F]+$/,a=0;a<e.length;a++)if(!t.test(e.charAt(a)))return!1;return!0}},{key:"uint8ToBase64",value:function(e){for(var t,a=0,n=e.length,o="";a<n;)t=e.subarray(a,Math.min(a+32768,n)),o+=String.fromCharCode.apply(null,t),a+=32768;return btoa(o)}},{key:"fromBase64",value:function(e){var t;try{t=atob(e).split("").map(function(e){return e.charCodeAt(0)})}catch(a){return new Uint8Array([])}return new Uint8Array(t)}},{key:"handleMessageChange",value:function(e){e!==this.state.message&&this.setState({message:e});var t=document.getElementById("psw_input").value,a=document.getElementById("resultTxt").value;t.length>0&&a.length>0?this.setState({decryptDisabled:!1}):this.setState({decryptDisabled:!0});var n=new Uint8Array(["Unknown"]),o=new m.a(t);this.state.payload.length>0&&(n=this.state.payload,e=this.uint8ToBase64(n)),t.length>0&&e.length>0&&(e=o.encrypt(e)),e.length>0?(n=new TextEncoder("utf-8").encode(e),this.setState({disabled:!1}),this.payloadChunks=this.chunkArray(n,32),this.payloadCountMax=this.payloadChunks.length,0===this.payloadCountMax&&(this.payloadCountMax=1)):(this.setState({disabled:!0}),this.payloadCountMax=1),this.payloadCount=0,this.setState({sendButtonTxt:"SEND "+(this.payloadCount+1)+"/"+this.payloadCountMax})}},{key:"handleFileSelect",value:function(e){e.stopPropagation(),e.preventDefault();var t=this,a=e.dataTransfer.files,n=new FileReader;n.onload=function(e){var o=n.result,l=new Uint8Array(o);l.length>0&&t.setState({payload:l,disabled:!1},function(){t.handleMessageChange("Loaded File: "+a[0].name)})},a[0].size<=this.maxFileSize?n.readAsArrayBuffer(a[0]):window.alert("Max file size allowed: 1 MB")}},{key:"handleDragOver",value:function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}},{key:"destroyClickedElement",value:function(e){document.body.removeChild(e.target)}},{key:"handleAutoCheck",value:function(e){this.setState({autoSend:!this.state.autoSend})}},{key:"downloadByteArray",value:function(){var e=this.decryptedResult,t=new TextDecoder("utf-8").decode(e),a=this.fromBase64(t);a.length>0&&(e=a);var n=[];e.forEach(function(e){n.push(e.toString(16))});var o=n.join("").toUpperCase(),l="message."+this.getMimetypeExt(o.substring(0,8)),s="QmFkIGRhdGEuIFRyeSB0byBjaGFuZ2UgdGhlIHJlY2VpdmUgZm9ybWF0Lg==";e.length>0&&(s=this.uint8ToBase64(e));var r=document.createElement("a");r.download=l,r.innerHTML="Download File",null!=window.webkitURL?r.href="data:application/octet-stream;base64,"+s:(r.href="data:application/octet-stream;base64,"+s,r.onclick=this.destroyClickedElement,r.style.display="none",document.body.appendChild(r)),r.click()}},{key:"getMimetypeExt",value:function(e){switch(e){case"89504E47":return"png";case"47494638":return"gif";case"25504446":return"pdf";case"FFD8FFDB":case"FFD8FFE0":return"jpg";case"49492A00":case"4D4D002A":return"tif";case"504B0304":return"zip";case"52617221":return"rar";case"52494646":return"wav";case"504D4F43":return"dat";case"75737461":return"tar";case"377ABCAF":return"7z";case"000001BA":case"000001B3":return"mpg";default:return""}}},{key:"startSDK",value:function(){var e=this;Object(p.Chirp)({key:"b2c2e7ed5Acebf8842C1f3F5F",onSending:function(t){console.log("Sending"),e.setState({disabled:!0,sendButtonTxt:"Sending "+(e.payloadCount+1)+"/"+e.payloadCountMax+"..."})},onSent:function(t){console.log("Data sent"),e.payloadCount++,e.payloadCount>=e.payloadChunks.length&&(e.payloadCount=0),e.setState({disabled:!1,sendButtonTxt:"SEND "+(e.payloadCount+1)+"/"+e.payloadCountMax}),e.setState({disabled:!1,sendButtonTxt:"SEND "+(e.payloadCount+1)+"/"+e.payloadCountMax},function(){e.payloadCount<e.payloadChunks.length&&e.setState({nextPart:!0})})},onReceiving:function(){console.log("Receiving..."),e.payloadCount=0,e.setState({disabled:!0,sendButtonTxt:"Incoming..."})},onReceived:function(t){if(console.log("Data received"),e.setState({sendButtonTxt:"SEND "+(e.payloadCount+1)+"/"+e.payloadCountMax}),t.length>0){var a=e.concatTypedArray(Uint8Array,e.state.receivedData,t),n=new TextDecoder("utf-8").decode(t);e.setState({receivedData:a,received:e.state.received+n}),e.decryptedResult=a,""!==document.getElementById("psw_input").value?e.setState({decryptDisabled:!1}):e.setState({decryptDisabled:!0}),e.setState({downloadDisabled:!1})}else alert("Missed data. Try increase the volume.")}}).then(function(t){e.sdk=t,e.setState({started:!0})}).catch(function(t){return console.error(t)&&t.message.includes("WebAssembly")?window.alert(t):window.alert(e.audioError)})}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"App"},o.a.createElement("header",null,o.a.createElement("h1",null,"Offline Audio Messenger")),this.state.started?o.a.createElement("div",null,o.a.createElement("button",{onClick:this.collapse,className:"IntroButton"},"HOW TO"),o.a.createElement("div",{className:"collapse-content"},o.a.createElement("strong",null,"No message data is shared but feel free to download site and use offline.",o.a.createElement("br",null)),o.a.createElement("ol",null,o.a.createElement("li",null,"Message/file is sent from one device to another using speaker and microphone."),o.a.createElement("li",null,"Use optional encryption to avoid anyone to intercept the audio."),o.a.createElement("li",null,"If they are far apart you can use a recorder for example a phone app."),o.a.createElement("li",null,"Each part is 32 chars and split automatically. Encryption is longer."),o.a.createElement("li",null,"Decryption needs to be done before downloading.")),o.a.createElement("br",null)),o.a.createElement("div",{className:"MsgBoxContainer"},o.a.createElement("input",{className:"MsgBox",type:"text",id:"message_input",placeholder:"Enter message",value:this.state.message,onChange:function(t){0===t.target.value.length?e.setState({payload:new Uint8Array([])},function(){e.handleMessageChange("")}):e.handleMessageChange(t.target.value)}}),o.a.createElement("div",{id:"drop_zone",onDragOver:this.handleDragOver,onDrop:this.handleFileSelect},"...or drop a file here"),o.a.createElement("input",{className:"MsgBox",type:"text",id:"psw_input",placeholder:"Encryption key (optional)",onChange:function(t){e.handleMessageChange(e.state.message)}})),o.a.createElement("div",null,o.a.createElement("label",{className:"AutoSend"},"Auto Send",o.a.createElement("input",{type:"checkbox",checked:this.state.autoSend,onChange:function(t){e.handleAutoCheck()}}))),this.state.disabled?o.a.createElement("button",{id:"sendButton",className:"SendButton",disabled:!0},this.state.sendButtonTxt):o.a.createElement("button",{id:"sendButton",className:"SendButton",onClick:function(){0===e.payloadCount||e.payloadCount>=e.payloadChunks.length?e.sdk.send(e.payloadChunks[0]):e.sdk.send(e.payloadChunks[e.payloadCount])}},this.state.sendButtonTxt),this.state.disabled?o.a.createElement("button",{id:"retryButton",className:"RetryButton",disabled:!0},"RETRY"):o.a.createElement("button",{id:"retryButton",className:"RetryButton",onClick:function(){e.payloadCount>0&&(e.payloadCount--,e.setState({sendButtonTxt:"SEND "+(e.payloadCount+1)+"/"+e.payloadCountMax}))}},"RETRY"),o.a.createElement("div",{className:"received-message"},o.a.createElement("textarea",{id:"resultTxt",className:"Result",rows:"10",value:this.state.received,placeholder:"Waiting on message...",readOnly:!0})),o.a.createElement("div",null,this.state.decryptDisabled?o.a.createElement("button",{id:"decryptButton",className:"DecryptButton",disabled:!0},"DECRYPT"):o.a.createElement("button",{id:"decryptButton",className:"DecryptButton",onClick:function(){var t=document.getElementById("psw_input"),a=new TextDecoder("utf-8").decode(e.state.receivedData),n="";try{n=new m.a(t.value).decrypt(a)}catch(o){console.error("Could not decrypt data.")}0===n.length&&(n="Failed to decrypt"),e.setState({received:n}),e.decryptedResult=new TextEncoder("utf-8").encode(n)}},"DECRYPT"),o.a.createElement("button",{id:"resetButton",className:"ResetButton",onClick:function(){e.setState({received:"",receivedData:new Uint8Array([]),message:"",payload:new Uint8Array([]),sendButtonTxt:"SEND 1/1",decryptDisabled:!0,downloadDisabled:!0}),e.payloadCount=0,e.payloadCountMax=1,e.payloadChunks=[]}},"RESET"),this.state.downloadDisabled?o.a.createElement("button",{id:"downloadButton",className:"DownloadButton",disabled:!0},"DOWNLOAD"):o.a.createElement("button",{id:"downloadButton",className:"DownloadButton",onClick:function(){e.downloadByteArray()}},"DOWNLOAD"))):o.a.createElement("div",{className:"Intro"},o.a.createElement("p",null,"Send a message or file using encrypted audio. Speaker and Mic required."),o.a.createElement("button",{className:"StartButton",onClick:function(){e.startSDK()}},"START")),o.a.createElement("div",{className:"extra"}),o.a.createElement("footer",{className:"Footer"},o.a.createElement("span",null,"Offline version can be downloaded at "),o.a.createElement("a",{href:"https://github.com/Joohansson/offline-audio-messenger"},"Github")))}}]),t}(o.a.Component)),g=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function v(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}s.a.render(o.a.createElement(f,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL(".",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat(".","/service-worker.js");g?(function(e,t){fetch(e).then(function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):v(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):v(t,e)})}}()}},[[22,1,2]]]);
//# sourceMappingURL=main.c1dd1a82.chunk.js.map